# 3 단원. 이미지 다듬기

### 목표

1. 다양한 low pass filter로 이미지 blur처리하기

2. 이미지에 직접 구현한 filter 적용하기 (2D convolution)

### 2D Convolution (이미지 필터)

1차원인 신호들이 그렇듯이, 이미지들 또한 다양한 low pass filter(LPF), high pass filter(HPF)들로 필터처리해줄 수 있다.<br>
LPF를 통해 노이즈를 제거하고, 이미지를 blur처리해줄 수 있다. HPF를 통해 이미지에서 각진 부분을 찾을 수 있다.<br><br>
OpenCV엔 cv.filter2D()라는 함수를 이용해서 이미지를 통해 kernel을 감싸줄 수 있다(convolve).<br>
예시로 이미지에 평균필터를 적용해보겠다.<br>
5x5 평균필터커널은 다음과 같이 생겼다<br>
<code>
K = (1 / 25) * [[1 1 1 1 1]
                [1 1 1 1 1]
                [1 1 1 1 1]
                [1 1 1 1 1]
                [1 1 1 1 1]]
</code>
간단한 작업이다.<br>

1. 이 커널을 픽셀 위에 놓고, 커널 밑에 있는 모든 25개의 픽셀을 더한다.

2. 그 평균값을 구하고 그 커널의 중간 픽셀을 평균값으로 대체한다.

3. 이미지에 있는 모든 픽셀에 대해 같은 연산을 해준다.

### 이미지 Blur 처리 (이미지 다듬기)

이미지 다듬기는 이미지를 LPF 커널을 통해 convolve하는 것이다.<br>
특히 이미지의 노이즈를 제거하는데 유용하다.<br>
정확하게 표현하자면, 이미지의 고주파 부분(노이즈, 각진 부분 등)을 제거한다<br>
그렇기 때문에 각진 부분들도 약간 blur 처리가 된다. (각을 blur 처리하지 않는 blur 처리법도 있다)<br>
OpenCV는 크게 네 가지 blur 처리법을 제공한다.<br><br>

#### 평균법

평균법은 표준화된 박스필터를 통해 이미지를 convolve해주는 것이다.<br>
우선 커널 밑의 모든 픽셀들의 평균을 구하여 중간 부분을 그 평균으로 대체한다.<br>
이 방식은 cv.blur() 혹은 cv.boxFilter()와 같은 함수를 이용한다.<br>
예를 들어 3x3 크기의 표준화박스필터는 다음과 같이 생겼다.<br>
<code>
K = (1 / 9) * [[1 1 1]
               [1 1 1]
               [1 1 1]]
</code><br>
만약  표준박스필터를 사용하고 싶지 않다면, cv.boxFilter() 함수를 사용하고, argument 중 normalize를 False로 해주면 된다.


#### 가우스 Blur법

박스 필터 대신 가우스 커널을 사용한다.<br>
구현은 cv.GaussianBlur() 함수를 통해 이루어진다.<br>
가우스 커널은 너비와 높이를 양수인 홀수로 지정해주어야하고, X와 Y 방향의 표준편차인 sigmaX와 sigmaY 또한 지정해주어야한다.<br>
만약 sigmaX만 지정해준다면 sigmaY는 자동으로 sigmaX와 같은 값을 갖는다.<br>
둘 다 값이 0이라면, 커널의 크기로부터 자동적으로 계산한다.<br>
가우스 blur법은 이미지에서 가우스 노이즈를 제거하는데 제일 효과적이다.<br><br>
만약 원한다면 cv.GaussianKernel() 함수를 이용해 가우스 커널을 생성할 수도 있다.

#### 중간값 Blur법

cv.MedianBlur() 함수는 커널 지역 밑의 픽셀들의 중간값을 구해 커널 중간에 있는 픽셀의 값에 할당한다.<br>
이와 같은 blur법은 이미지에 마치 소금과 후추처럼 생긴 노이즈를 제거하는데 유용하다.<br>
흥미로운점은 위의 두 가지 필터에서 중간 원소에 할당되는 값들은 원래 그 픽셀의 값과 같거나 다를 수 있다.<br>
하지만 중간값 blur법에선 중간 원소의 값은 언제나 이미지의 어떤 픽셀 값으로 대체된다.<br>
이를 통해 노이즈를 효과적으로 지울 수 있게 된다.<br>
커널의 크기는 반드시 양수인 홀수이다.

#### 쌍방필터법

cv.bilateralFilter() 함수는 노이즈를 제거하면서 각진 부분을 유지하고 싶을 때 사용한다.<br>
다만 문제는 다른 필터들에 비해서 계산 속도가 매우 느리다는 것이다.<br>
가우스 필터를 생각해보자. 가우스 필터는 근처 픽셀 값을 통해 가우스무게평균을 구한다.<br>
가우스 필터는 공간을 고려하는 필터이다. 즉, 필터를 할 때 주변 픽셀을 고려한다는 것이다<br>
주변 픽셀이 같은 intensity를 갖는 말든 고려하지 않는다.<br>
픽셀이 각진 부분의 픽셀인지 고려를 하지 않기 때문에 각진 부분도 blur 처리한다. 하지만 우리가 원하는 건 그런게 아니다.<br><br>
쌍방필터는 가우스필터를 사용하기는 하지만, 픽셀의 차이를 고려하는 가우스필터 함수를 한 개 더 사용한다.<br>
공간을 고려하는 가우스 함수는 근처 픽셀들을 통해 blur 처리를 해주지만,<br>
intensity를 고려하는 두번째 가우스 함수는 이 blur 처리에서 중간 픽셀과 비슷한 intensity를 갖는 픽셀들만 blur 처리를 할 때 사용되도록 해준다.<br>
그렇기 때문에 각진 부분의 픽셀들은 각진 부분과 아닌 부분이 서로 다른 intensity 값을 갖기에 각진 부분이 보존된다.